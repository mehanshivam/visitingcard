# Story 2.2: Enhanced Field Detection with Job Title & Address Support

## Status
Draft

## Story
**As a** user,
**I want** accurate detection of job titles, company names, and address information from business cards,
**so that** I get complete contact information with proper field categorization and no confusion between company and job title

## Acceptance Criteria
1. Correctly distinguish between company name and job title with 80%+ accuracy
2. Extract job titles/designations as a separate field (CEO, Manager, Engineer, etc.)
3. Detect and parse address information (street, city, state, zip, country)
4. Maintain 85%+ accuracy for existing fields (name, phone, email, website)
5. Support common business card layouts (horizontal, vertical, multi-line addresses)
6. Handle edge cases: person without company, multiple addresses, international formats
7. Add confidence scoring for new fields (title, address components)

## Tasks / Subtasks
- [ ] Task 1: Analyze current company vs title confusion patterns (AC: 1, 2)
  - [ ] Review test cases where company/title detection fails
  - [ ] Create comprehensive job title keyword dictionary
  - [ ] Document business entity vs job title indicators
  - [ ] Test current parser against diverse business card samples
- [ ] Task 2: Implement job title detection logic (AC: 2, 7)
  - [ ] Create dedicated title parsing with position and keyword analysis
  - [ ] Add common job title patterns and hierarchies
  - [ ] Implement title vs company name disambiguation
  - [ ] Add confidence scoring for title detection
- [ ] Task 3: Build comprehensive address parsing (AC: 3, 5, 6)
  - [ ] Create address detection patterns for US and international formats
  - [ ] Implement street address, city, state, zip code extraction
  - [ ] Handle multi-line address formats and variations
  - [ ] Add support for international address formats
- [ ] Task 4: Enhanced company name detection (AC: 1, 4)
  - [ ] Improve company name detection to exclude job titles
  - [ ] Add business entity suffix recognition (LLC, Inc, Corp, Ltd, etc.)
  - [ ] Handle company names with special formatting
  - [ ] Distinguish between company names and department names
- [ ] Task 5: Update data structures and UI (AC: All)
  - [ ] Add title and address fields to ContactData interface
  - [ ] Update ResultsStep component to display new fields
  - [ ] Add proper field labels and formatting for addresses
  - [ ] Implement field validation for new data types
- [ ] Task 6: Integration and testing (AC: All)
  - [ ] Integrate enhanced parsing with existing OCR workflow
  - [ ] Create comprehensive test suite with real business card samples
  - [ ] Validate accuracy requirements against test dataset
  - [ ] Test edge cases and international card formats

## Dev Notes

### Current Issues Analysis
Based on user feedback from Epic 2 testing:
- **Company vs Title Confusion**: Parser incorrectly assigns job titles to company field
- **Missing Address Field**: No address detection capability currently implemented
- **Field Completeness**: Need comprehensive contact information extraction

### Field Detection Priority
1. **Job Title/Designation** - High priority, user requirement
2. **Address Components** - High priority, common on business cards
3. **Enhanced Company Detection** - Medium priority, improve existing
4. **Field Validation** - Medium priority, data quality

### Technical Architecture
[Source: architecture/3-detailed-component-architecture.md#31-frontend-architecture]
- Extend existing `src/services/ocrService.ts` with enhanced field detection
- Add new parsing methods for title and address extraction
- Update ContactData interface and UI components
- Maintain backward compatibility with Epic 1 functionality

### Address Parsing Strategy
**US Address Formats:**
- Street Address: 123 Main St, 456 Oak Avenue, Suite 100
- City, State ZIP: New York, NY 10001
- Extended: City, State ZIP-4: New York, NY 10001-1234

**International Support:**
- UK: Street, City, Postal Code format
- Canada: Similar to US with postal codes
- Basic international city, country detection

### Job Title Detection Strategy
**Common Patterns:**
- Executive titles: CEO, CTO, CFO, President, VP, Director
- Management: Manager, Senior Manager, Team Lead, Head of
- Technical: Engineer, Developer, Architect, Analyst, Specialist
- Sales/Marketing: Sales Manager, Marketing Director, Account Executive
- Consulting: Consultant, Senior Consultant, Principal, Partner

**Position-based Detection:**
- Titles often appear before or after person name
- Usually shorter than company names
- Contain role/hierarchy indicators

### Data Structure Updates
```typescript
interface ContactData {
  name?: string;
  title?: string;        // NEW: Job title/designation
  company?: string;
  phone?: string;
  email?: string;
  website?: string;
  address?: {           // NEW: Address components
    street?: string;
    city?: string;
    state?: string;
    zip?: string;
    country?: string;
    full?: string;      // Complete address string
  };
  raw_text: string;
  confidence: number;
}
```

### Testing Strategy
- **Real Business Card Dataset**: Collect diverse card formats for testing
- **Accuracy Metrics**: Track field detection accuracy per type
- **Edge Case Testing**: Cards without companies, multiple addresses, international cards
- **Regression Testing**: Ensure existing Epic 1 functionality still works
- **User Acceptance Testing**: Validate against original user feedback

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-19 | 1.0 | Initial story creation based on Epic 2 user feedback | James (Dev Agent) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*TBD during implementation*

### Debug Log References
*TBD during implementation*

### Completion Notes List
*TBD during implementation*

### File List
*TBD during implementation*

## QA Results
*Results from QA Agent QA review of the completed story implementation*