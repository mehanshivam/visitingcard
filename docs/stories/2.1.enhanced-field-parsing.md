# Story 2.1: Enhanced Field Parsing Algorithms

## Status
Draft

## Story
**As a** user,
**I want** improved accuracy in contact field extraction from business cards,
**so that** I get reliable, correctly parsed contact information with minimal manual correction

## Acceptance Criteria
1. Achieve 85%+ accuracy for email detection (up from current ~70%)
2. Achieve 80%+ accuracy for phone number detection with format standardization
3. Achieve 75%+ accuracy for name identification using position and context analysis
4. Achieve 70%+ accuracy for company identification using business keywords
5. Handle multiple contact formats (international phone, various email domains)
6. Add confidence scoring per field for quality assessment
7. Implement fuzzy matching for common business card variations

## Tasks / Subtasks
- [ ] Task 1: Analyze current parsing gaps and create test dataset (AC: All)
  - [ ] Collect diverse business card text samples for testing
  - [ ] Analyze current parser failures and edge cases
  - [ ] Create comprehensive test dataset with expected outputs
  - [ ] Document common parsing patterns and failures
- [ ] Task 2: Enhanced email detection algorithms (AC: 1)
  - [ ] Improve email regex patterns for edge cases
  - [ ] Add validation for email domain correctness
  - [ ] Handle multiple emails on single card
  - [ ] Add international domain support (.co.uk, .com.au, etc.)
- [ ] Task 3: Advanced phone number parsing (AC: 2, 5)
  - [ ] Support international phone formats (+44, +1, etc.)
  - [ ] Handle extension numbers and multiple contact numbers
  - [ ] Standardize phone number formatting
  - [ ] Detect and parse mobile vs office numbers
- [ ] Task 4: Intelligent name detection (AC: 3)
  - [ ] Implement position-based name detection (typically first/prominent line)
  - [ ] Add common name pattern recognition
  - [ ] Filter out titles (Mr., Dr., CEO, etc.) from names
  - [ ] Handle multi-part names (First Middle Last, hyphenated names)
- [ ] Task 5: Smart company identification (AC: 4)
  - [ ] Create business entity keyword dictionary (LLC, Inc, Corp, Ltd, etc.)
  - [ ] Implement company name pattern detection
  - [ ] Handle company names with special characters
  - [ ] Distinguish between company names and job titles
- [ ] Task 6: Field confidence scoring and validation (AC: 6)
  - [ ] Implement confidence scoring per extracted field
  - [ ] Add field validation rules (email format, phone format, etc.)
  - [ ] Create quality thresholds for auto-acceptance vs manual review
  - [ ] Add field-specific error handling and suggestions
- [ ] Task 7: Fuzzy matching and error correction (AC: 7)
  - [ ] Implement fuzzy string matching for OCR text errors
  - [ ] Add common OCR error corrections (0/O, 1/l, etc.)
  - [ ] Handle partial text extraction and reconstruction
  - [ ] Add spell checking for names and company words

## Dev Notes

### Current Parser Analysis
Based on Epic 1 testing, current parsing issues include:
- Inconsistent name detection (sometimes picks company name as person name)
- Phone number formats not standardized
- Email detection works but could be more robust
- Company identification confused by job titles
- No confidence scoring to indicate parsing reliability

### Technical Architecture
[Source: architecture/3-detailed-component-architecture.md#31-frontend-architecture]
- Enhance existing `src/services/ocrService.ts` parseContactData method
- Add new field-specific parsing modules
- Implement validation and confidence scoring utilities
- Maintain backward compatibility with current data structures

### Enhanced Parsing Strategy
1. **Multi-pass parsing**: First pass for obvious patterns, second pass for context analysis
2. **Position analysis**: Use text positioning and line order for field identification
3. **Pattern libraries**: Build comprehensive regex and keyword libraries
4. **Validation pipeline**: Implement field validation with confidence scoring
5. **Error correction**: Add fuzzy matching and common OCR error fixes

### Testing Strategy
- Comprehensive test suite with real business card samples
- A/B testing against current parser for accuracy comparison
- Performance benchmarking to ensure parsing speed
- Edge case testing with unusual business card formats
- Accuracy metrics tracking per field type

### Data Flow Enhancement
[Source: architecture/4-data-architecture.md#42-data-flow-architecture]
- Enhanced ContactData interface with confidence scores
- Field validation results and suggestions
- Parsing metadata for debugging and improvement
- Support for multiple parsing candidates per field

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-19 | 1.0 | Initial story creation for Epic 2 | James (Dev Agent) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*TBD during implementation*

### Debug Log References
*TBD during implementation*

### Completion Notes List
*TBD during implementation*

### File List
*TBD during implementation*

## QA Results
*Results from QA Agent QA review of the completed story implementation*